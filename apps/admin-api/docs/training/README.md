# IAM-API 架构培训教程

## 📚 培训概述

本培训教程旨在帮助开发人员全面理解和掌握 `admin-api` 项目采用的 **Clean Architecture + CQRS + 事件驱动架构（EDA）** 组合架构模式。

### 培训目标

完成本培训后，您将能够：

- ✅ 理解 Clean Architecture、CQRS 和 EDA 的核心概念和原理
- ✅ 掌握项目中的架构层次和依赖关系
- ✅ 能够按照正确的开发流程创建新的功能模块
- ✅ 理解聚合根、值对象、领域事件等 DDD 概念
- ✅ 掌握命令、查询、事件处理器的编写方法
- ✅ 理解端口适配器模式的应用
- ✅ 能够进行架构一致性检查和代码审查

### 培训对象

- 新加入项目的开发人员
- 需要深入了解架构的团队成员
- 希望学习企业级架构模式的开发者

### 前置要求

- 熟悉 TypeScript 和 NestJS 框架
- 了解面向对象编程（OOP）基础概念
- 有后端开发经验

## 📖 培训大纲

### 第一部分：基础篇（Foundation）

**学习目标**：建立架构基础认知，理解核心概念

1. [架构概述](./01-基础篇/01-架构概述.md)
   - 架构目标和原则
   - 三种架构模式简介
   - 架构优势

2. [核心概念](./01-基础篇/02-核心概念.md)
   - Clean Architecture 基础
   - CQRS 基础
   - 事件驱动架构基础
   - 领域驱动设计（DDD）基础

3. [项目结构](./01-基础篇/03-项目结构.md)
   - 目录层次结构
   - 各层职责说明
   - 有界上下文组织

4. [DDD 编程思想](./01-基础篇/04-DDD编程思想.md)
   - 面向领域 vs 面向数据库
   - 为什么领域模型优先
   - 编程思维的转变

### 第二部分：进阶篇（Advanced）

**学习目标**：深入理解各架构模式的实现细节

4. [Clean Architecture 详解](./02-进阶篇/01-Clean-Architecture详解.md)
   - 分层架构原理
   - 依赖规则
   - 端口适配器模式
   - 各层职责详解

5. [CQRS 模式详解](./02-进阶篇/02-CQRS模式详解.md)
   - 命令和查询分离
   - Use Case 实现
   - 命令处理器
   - 查询处理器
   - 读写分离

6. [事件驱动架构详解](./02-进阶篇/03-事件驱动架构详解.md)
   - 领域事件概念
   - 事件发布和处理
   - 事件流设计
   - 最终一致性

7. [事件溯源详解](./02-进阶篇/04-事件溯源详解.md)
   - 事件溯源原理
   - 事件存储设计
   - 状态重建机制
   - 快照策略
   - 与 CQRS、EDA 的结合

8. [领域驱动设计详解](./02-进阶篇/05-领域驱动设计详解.md)
   - 聚合根（Aggregate Root）
   - 值对象（Value Object）
   - 领域事件（Domain Event）
   - 有界上下文（Bounded Context）

### 第三部分：实践篇（Practice）

**学习目标**：掌握实际开发流程和最佳实践

8. [开发流程指南](./03-实践篇/01-开发流程指南.md)
   - 开发顺序：聚合根 → 数据库实体
   - 开发步骤详解
   - 开发检查清单

9. [聚合根开发](./03-实践篇/02-聚合根开发.md)
   - 聚合根设计原则
   - 领域方法编写
   - 工厂方法使用
   - 领域事件发布

10. [聚合根开发](./03-实践篇/02-聚合根开发.md)
    - 聚合根设计原则
    - 领域方法编写
    - 工厂方法使用
    - 领域事件发布

11. [Use Case 开发](./03-实践篇/03-Use-Case开发.md)
    - Use Case 识别
    - Command Handler 编写
    - Query Handler 编写
    - Application Service 编写

12. [端口适配器实现](./03-实践篇/04-端口适配器实现.md)
    - 端口接口定义
    - 适配器实现
    - 依赖注入配置
    - 映射逻辑编写

13. [聚合根与数据库实体映射](./03-实践篇/05-聚合根与数据库实体映射.md)
    - 映射机制
    - 值对象处理
    - 同步维护策略

14. [数据库迁移指南](./03-实践篇/06-数据库迁移指南.md)
    - 数据库可替换性
    - PostgreSQL → MongoDB 迁移步骤
    - MikroORM 多数据库支持
    - 迁移检查清单

### 第四部分：案例篇（Case Studies）

**学习目标**：通过实际案例加深理解

13. [用户管理模块案例](./04-案例篇/01-用户管理模块案例.md)
    - 完整的开发流程
    - 代码示例解析
    - 最佳实践应用

14. [角色管理模块案例](./04-案例篇/02-角色管理模块案例.md)
    - 树形结构处理
    - 权限关联设计
    - 事件处理示例

15. [实战练习](./04-案例篇/03-实战练习.md)
    - 练习题目
    - 参考答案
    - 常见问题解答

## 🎯 学习路径

### 路径一：快速入门（2-3 天）

适合：新加入项目的开发人员，需要快速上手

1. 架构概述（1 小时）
2. 核心概念（2 小时）
3. 项目结构（1 小时）
4. 开发流程指南（2 小时）
5. 用户管理模块案例（3 小时）

**总计**：约 9 小时

### 路径二：系统学习（1-2 周）

适合：希望全面掌握架构的团队成员

1. 完成基础篇所有章节（2-3 天）
2. 完成进阶篇所有章节（3-4 天）
3. 完成实践篇所有章节（2-3 天）
4. 完成案例篇所有章节（2-3 天）

**总计**：约 9-13 天

### 路径三：深度学习（1 个月）

适合：架构师、技术负责人

1. 系统学习所有章节
2. 阅读源码，理解实现细节
3. 完成所有实战练习
4. 参与代码审查和架构设计

## 📝 学习建议

### 1. 循序渐进

- 先理解概念，再动手实践
- 不要跳过基础篇，直接进入实践
- 每个章节完成后，尝试总结要点

### 2. 理论结合实践

- 阅读文档的同时，查看实际代码
- 完成每个章节的练习
- 尝试修改现有代码，验证理解

### 3. 主动思考

- 思考为什么这样设计
- 思考是否有更好的方案
- 思考如何应用到自己的项目中

### 4. 交流讨论

- 与团队成员讨论
- 参与代码审查
- 分享学习心得

## 🔗 相关资源

### 文档资源

- [架构原理与术语定义文档](../ARCHITECTURE.md)
- [IAM-API 架构设计文档](../IAM-API-ARCHITECTURE.md)
- [开发流程指南](../DEVELOPMENT-WORKFLOW.md)
- [聚合根与数据库实体映射](../AGGREGATE-ENTITY-MAPPING.md)
- [Use Case 实现说明](../USE-CASE-IMPLEMENTATION.md)

### 代码资源

- 项目源码：`apps/admin-api/src/`
- 示例模块：`apps/admin-api/src/lib/bounded-contexts/iam/authentication/`
- 测试代码：`apps/admin-api/tests/`

### 外部资源

- [Clean Architecture by Robert C. Martin](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [CQRS Pattern](https://martinfowler.com/bliki/CQRS.html)
- [Domain-Driven Design](https://martinfowler.com/bliki/DomainDrivenDesign.html)
- [Event-Driven Architecture](https://martinfowler.com/articles/201701-event-driven.html)

## ✅ 学习检查清单

完成培训后，请检查以下内容：

### 基础理解

- [ ] 能够解释 Clean Architecture 的分层结构
- [ ] 理解 CQRS 的读写分离原理
- [ ] 理解事件驱动架构的优势
- [ ] 知道聚合根、值对象、领域事件的区别

### 实践能力

- [ ] 能够按照正确顺序开发新功能
- [ ] 能够编写聚合根和领域方法
- [ ] 能够编写 Command Handler 和 Query Handler
- [ ] 能够定义端口接口和实现适配器
- [ ] 能够处理聚合根与数据库实体的映射

### 架构理解

- [ ] 理解依赖方向和依赖倒置原则
- [ ] 理解 Use Case 在应用层的作用
- [ ] 理解端口适配器模式的应用
- [ ] 能够进行架构一致性检查

## 🎓 培训反馈

如果您在学习过程中遇到问题或有改进建议，请：

1. 在项目 Issue 中提出
2. 与团队讨论
3. 更新培训文档

---

**培训版本**：v1.0.0  
**最后更新**：2024-01-XX  
**维护者**：架构团队
