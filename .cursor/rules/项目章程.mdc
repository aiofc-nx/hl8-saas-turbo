---
description: 项目章程
globs:
alwaysApply: true
---
# hl8-saas-ai-platform Constitution

## Core Principles

### I. 中文优先原则

- 所有代码注释、技术文档、错误消息、日志输出及用户界面文案必须使用中文，且注释遵循 TSDoc 规范。
- Git 提交信息须使用英文描述；代码变量命名保持英文，但必须配有中文注释说明业务语义。

**理由**：统一中文语境提升团队沟通效率，确保业务认知一致，降低知识传递成本。

### II. 代码即文档原则

- 公共 API、类、方法、接口、枚举必须编写完整 TSDoc 注释，覆盖功能描述、业务规则、使用场景、前置条件、后置条件、异常抛出及注意事项。
- 代码变更时必须同步更新注释，保持实现与文档一致。

**理由**：通过高质量注释让代码自身成为权威业务文档，缩短交接时间并减少额外文档维护负担。

### III. 技术栈约束原则

- 全仓统一采用 Node.js + TypeScript，使用 pnpm 管理依赖并通过 monorepo 组织代码。
- **TypeScript 配置**：所有项目必须启用 NodeNext 模块系统：`module`/`moduleResolution` 设为 `NodeNext`，`target` 设为 `ESNext`，`strict` 启用。
- **模块系统规范**：
  - **库项目（libs/**）**：`package.json` 中**禁止**声明 `type: "module"`，编译为 CommonJS 格式（服务于 NestJS）。必须通过 `exports` 字段同时提供 `import` 和 `require` 条件，确保可在 CommonJS 和 ESM 环境中使用。必须声明 `engines: { "node": ">=20" }`。
  - **NestJS 应用（apps/*-api）**：`package.json` 中**禁止**声明 `type: "module"`，运行时必须使用 CommonJS。TypeScript 配置使用 `NodeNext` 仅用于类型检查，实际编译输出由 SWC 处理为 CommonJS。
  - **前端应用（apps/web）**：前端应用配置不执行后端项目的规范，根据选用的框架另行规定。
- 服务端基础框架固定为 NestJS + Fastify，无需兼容 Express。
- 数据访问层统一使用 MikroORM 管理实体生命周期与迁移。
- 关系型数据库选型锁定 PostgreSQL，文档型数据库选型锁定 MongoDB。

**理由**：统一技术栈、框架与依赖选择可提升跨团队协作效率，降低学习成本，并确保在性能、扩展性与安全性上的基线能力一致。区分库与应用的模块系统规范，既保证了库的现代化（ESM），又兼容了 NestJS 的运行时要求（CommonJS）。

### IV. 测试要求原则

- 单元测试与被测文件同目录(旁放，而不是创建新目录)，命名 `{filename}.spec.ts`；
- 集成与端到端测试集中放置在 `tests/integration/` 与 `tests/e2e/`。
- 采用分层测试策略：单元、集成、端到端各司其职，确保快速反馈与可维护性。
- 核心业务逻辑测试覆盖率须达到 80% 以上，关键路径 90% 以上，所有公共 API 必须具备测试用例。

**理由**：高标准测试体系保障关键功能可靠性，支持快速迭代并防止回归。


